# 销售员回款数据转换工具（2025年数据版）

## 功能说明

本工具可以将原始的月度回款数据表（`2025.1月-9月回款(1).xlsx`）转换为标准的销售员回款汇总表模板格式。

**特别说明：** 本工具专门提取**2025年的回款数据**，会自动忽略2024年的数据。

## 转换结果

✅ **已成功转换完成！**

- **源数据文件**: `2025.1月-9月回款(1).xlsx`
- **输出文件**: `销售员回款汇总表_1-9月_2025年数据_最终版.xlsx`
- **转换脚本**: `转换为模板格式_最终版.py`

### 转换统计

- **总业务员数**: 29人
- **总回款金额**: ￥67,686,252.51元 **（2025年数据）**
- **数据覆盖**: 1-9月份

### 前10名业务员回款情况（2025年数据）

| 排名 | 销售员 | 销售部门 | 1月 | 2月 | 3月 | 参考总额(元) |
|-----|-------|---------|-----|-----|-----|------------|
| 1 | 专卖店 | 销管部 | 689,480 | 971,987 | 1,626,326 | 10,310,509 |
| 2 | 朱海燕 | 销管部 | 610,515 | 228,000 | 1,232,002 | 5,460,105 |
| 3 | 竹国龙 | 销管部 | 422,138 | 272,532 | 560,201 | 4,662,536 |
| 4 | 王军杰 | 销管部 | 740,244 | 353,007 | 885,579 | 4,349,538 |
| 5 | 董培培 | 杭州大区 | 275,018 | 216,973 | 224,753 | 4,031,768 |
| 6 | 李宾 | 温州办事处 | 285,836 | 257,630 | 443,078 | 3,480,783 |
| 7 | 张斌 | 销管部 | 382,132 | 180,297 | 396,717 | 3,388,927 |
| 8 | 李燕霞 | 销管部 | 513,988 | 463,070 | 639,327 | 3,080,772 |
| 9 | 吴月芳 | 销管部 | 226,083 | 212,175 | 239,048 | 2,744,882 |
| 10 | 吴海林 | 杭州大区 | 302,627 | 183,015 | 407,258 | 2,694,961 |

## 数据来源

脚本从以下地区工作表中提取2025年数据：

- 杭州（2行表头）
- 湖州（2行表头）
- 金衢（2行表头）- 金华/衢州
- 嘉兴（2行表头）
- 台州（2行表头）
- 绍兴（2行表头）
- 温丽（2行表头）- 温州/丽水

## 转换逻辑

### 1. 表头结构识别

原始Excel文件中，各工作表都有2行表头结构：
- **第0行**: 字段名（"1月"、"2月"、"同比"等）
- **第1行**: 年份标识（"2024年"、"2025年"）
- **第2行开始**: 实际数据

由于合并单元格的原因，月份列会跨2列（2024年和2025年）。脚本会：
1. 扫描第0行找到月份列（"1月"至"9月"）
2. 扫描第1行找到"2025年"标识
3. 匹配月份和年份，定位2025年数据所在的列

### 2. 数据提取

- **按业务员分组**: 汇总其负责的所有门店/客户的月度回款
- **只提取2025年数据**: 自动忽略2024年数据列
- **月份范围**: 1-9月

### 3. 部门匹配

根据员工基础信息表自动匹配销售部门：
- 员工表中的业务员：使用地区映射到对应部门
  - 杭州 → 杭州大区
  - 湖州 → 湖州办事处
  - 金华 → 金华办事处
  - 温州 → 温州办事处
  - 等等
- 未在员工表中的：默认归入"销管部"

### 4. 销售组织

统一填充为"杭州中冠电器有限公司"

## 关键技术点

### 合并单元格处理

Excel中的合并单元格在pandas读取时会被拆分，只有第一个单元格保留值，其他变为NaN。例如：

```
原Excel:  |  1月  (合并2列)  |
pandas:   | "1月" | NaN |
年份行:    | 2024年 | 2025年 |
```

脚本通过以下方式解决：
1. 记录当前月份（遇到有值的月份列时）
2. 向后查找年份标识
3. 匹配月份+年份，定位正确的数据列

### 示例：湖州工作表

```python
列9:  "1月"    + "2024年"  ← 2024年1月
列10: "NaN"    + "2025年"  ← 2025年1月（我们要的！）
列11: "同比"   + NaN
列12: "2月"    + "2024年"  ← 2024年2月
列13: "NaN"    + "2025年"  ← 2025年2月（我们要的！）
```

## 如何重新运行转换

如果需要重新转换数据或处理新的数据文件：

```bash
cd "/Users/gndys/Documents/编程开发/#开发中ind/可行性 MVP/02/9.29 新/00-数据准备/模板数据/9 月"
python 转换为模板格式_最终版.py
```

## 输出格式

输出的Excel文件包含以下列：

| 列名 | 说明 |
|-----|------|
| 销售员 | 业务员姓名 |
| 销售组织 | 杭州中冠电器有限公司 |
| 销售部门 | 所属部门（杭州大区、湖州办事处等） |
| 1月~9月 | 各月回款金额（**2025年数据**） |
| 10月~12月 | 暂填0（可后续补充） |
| 参考总额 | 1-9月合计金额 |
| 填写说明 | 提示信息 |

## 数据对比

| 版本 | 数据年份 | 总回款金额 | 说明 |
|------|---------|-----------|------|
| 旧版本 | 2024年 | ￥61,028,916.39 | 错误提取了2024年数据 |
| **最终版** | **2025年** | **￥67,686,252.51** | ✅ 正确提取2025年数据 |

## 注意事项

1. ✅ **已解决**: 所有工作表都正确识别为2行表头（之前误以为杭州是3行）
2. ✅ **已解决**: 合并单元格导致的年份识别问题
3. ✅ **数据验证**: 2025年数据大于2024年，符合业务增长预期
4. ⚠️ 部分业务员名称（如"专卖店"、"零售"、"杭州零售"等）可能需要人工核对
5. ⚠️ 10-12月数据暂时为0，如有实际数据需手动补充

## 文件清单

- ✅ `销售员回款汇总表_1-9月_2025年数据_最终版.xlsx` - **最终转换结果（2025年数据）**
- ✅ `转换为模板格式_最终版.py` - 转换脚本
- ✅ `2025.1月-9月回款(1).xlsx` - 原始数据
- ✅ `销售员回款汇总表_月度明细模板.xlsx` - 模板参考
- ✅ `使用说明.md` - 本文档

## 故障排查

如果重新运行脚本遇到问题：

### 问题1: 数据全为0
**原因**: 可能误提取了2024年数据或表头识别错误  
**解决**: 检查脚本中的年份匹配逻辑，确保查找"2025年"字符串

### 问题2: 某个地区数据缺失
**原因**: 工作表名称不匹配或表头结构变化  
**解决**: 检查工作表名称（注意空格，如"温丽 "末尾有空格）

### 问题3: 列索引越界
**原因**: skiprows参数设置错误  
**解决**: 所有工作表都应使用`skiprows=2`

---

*最后更新时间: 2025-10-17 09:52*  
*数据年份: 2025年*  
*版本: 最终版 v2.0*
