# Excel 数据匹配工具 - 使用说明

## 功能概述

这是一个智能的Excel数据匹配工具，可以将销售订单数据与多个数据源进行自动匹配，包括：
- 收款单
- 带单费
- 政策表（特价机、佳尼特、壁挂炉、活动）

## 使用步骤

### 第一步：上传文件

1. **销售订单表**（必需）
   - 点击"选择文件"上传销售订单Excel文件
   - 如果有多个子表，选择需要的子表

2. **收款单表**（可选）
   - 上传收款单Excel文件
   - 选择对应的子表

3. **带单费表**（可选）
   - 上传带单费Excel文件
   - 选择对应的子表

4. **政策表**（可选）
   - 上传政策表Excel文件
   - **政策表会自动加载所有子表**（特价机整理、佳尼特、壁挂炉、活动）
   - 无需每次重新上传，一次上传即可

### 第二步：配置字段映射

系统会自动进行智能匹配，但你可以手动调整：

#### 销售订单字段映射（基础字段）
- 日期 → `日期`
- 单据编号 → `单据编号`
- 用户姓名 → `用户姓名`
- 规格型号 → `规格型号`
- 销售数量 → `销售数量`
- 价税合计 → `价税合计`
- 系统定价 → `系统定价`
- 物料名称 → `物料名称`
- 物料类别 → `物料类别`
- 促销员 → `促销员`
- 客户店名 → `客户`
- 单据类型 → `单据类型`

#### 收款单字段映射
- 单据编号 → `销售订单号`
- 收款金额 → `求和项:收款金额`

**匹配规则**：根据单据编号匹配，相同单据编号的收款金额会自动求和

#### 带单费字段映射
- 单号 → `单号`
- 支付带单提成点位 → `支付带单提成点位`
- 卖出的实际折扣 → `折扣`

**匹配规则**：根据单据编号（销售订单）和单号（带单费）匹配

#### 政策表字段映射

**1. 特价机整理子表**
- 机型 → `机型`（提取字段）
- 大类型 → `大类型`（提取字段）
- 特价机提成计算方案 → `提成计算`
- 特价机公司最低折扣 → `公司最低折扣`

**2. 佳尼特子表**
- 佳尼特特价 → `特价`

**3. 壁挂炉子表**
- 壁挂炉销售折扣 → `销售折扣`
- 壁挂炉提成 → `提成`

**4. 活动子表**
- 七月部分活动折扣率 → `折扣率`
- 七月部分活动提成 → `提成`
- 七月部分活动加提 → `加提`
- 七月部分活动活动要求 → `加提要求`

**匹配规则**：所有政策表都根据规格型号（销售订单）和型号（政策表）进行精确匹配

### 第三步：执行匹配

1. 确认字段映射正确后，点击"开始匹配"按钮
2. 系统会自动进行数据匹配
3. 查看匹配结果和统计信息

### 第四步：导出结果

1. 查看匹配统计：
   - 总记录数
   - 各数据源的匹配成功数量
   
2. 预览匹配结果（显示前1000条）

3. 点击"导出结果"按钮下载完整的匹配结果Excel文件

## 匹配逻辑说明

### 收款单匹配
- **匹配键**：单据编号（销售订单）→ 销售订单号（收款单）
- **匹配方式**：精确匹配
- **特殊处理**：相同单据编号的收款金额会自动求和

### 带单费匹配
- **匹配键**：单据编号（销售订单）→ 单号（带单费）
- **匹配方式**：精确匹配

### 政策表匹配
- **匹配键**：规格型号（销售订单）→ 型号（政策表各子表）
- **匹配方式**：精确匹配
- **多子表处理**：自动从4个子表中分别匹配对应字段
- **特价机整理**：除了匹配数据，还会提取"机型"和"大类型"字段

## 注意事项

1. **销售订单表是必需的**，其他表都是可选的
2. **政策表只需上传一次**，会自动加载所有子表
3. 如果某个字段在Excel中找不到对应列，可以选择"-- 请选择列 --"跳过该字段
4. 匹配时会自动去除字符串两端的空格
5. 结果表格显示前1000条记录，完整数据请导出查看
6. 导出的文件名会自动包含日期和时间

## 常见问题

**Q: 为什么有些记录没有匹配成功？**
A: 可能是因为：
- 单据编号或规格型号在两个表中不一致
- 存在多余的空格或特殊字符
- 数据格式不同（如数字vs文本）

**Q: 政策表需要每次都上传吗？**
A: 不需要。政策表上传一次后，会自动加载所有4个子表的数据。只有当你需要使用不同的政策表时才需要重新上传。

**Q: 可以只匹配部分数据源吗？**
A: 可以。只需上传你需要的文件即可，其他数据源的字段会留空。

**Q: 匹配结果可以重新匹配吗？**
A: 可以。调整字段映射后，点击"重新匹配"按钮即可。

## 技术支持

如有问题，请联系技术支持。

