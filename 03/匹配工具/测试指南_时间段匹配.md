# 销售政策时间段匹配 - 测试指南

## 测试准备

### 1. 准备测试用的政策表

创建一个包含多个活动子表的Excel文件：

**子表1：活动_测试1**
- M列（第13列）所有行填写：2025.9.15
- N列（第14列）所有行填写：2025.10.8
- 包含几个测试型号的政策数据

**子表2：活动_测试2**
- M列（第13列）所有行填写：2025.10.9
- N列（第14列）所有行填写：2025.10.20
- 包含相同型号但不同政策的数据

### 2. 准备测试用的销售订单

创建销售订单Excel，包含：
- 不同日期的订单（如2025.9.20、2025.10.15等）
- 与政策表中相同的规格型号
- 日期字段使用常见格式

## 测试步骤

### 测试1：基本功能测试

**步骤：**
1. 打开匹配工具（匹配工具.html）
2. 上传政策表
3. 检查文件信息区域是否显示活动子表数量和时间段

**预期结果：**
```
✓ 政策表已加载
📅 销售政策时间段（2个）：
  1. 活动_测试1: 2025.9.15 ~ 2025.10.8
  2. 活动_测试2: 2025.10.9 ~ 2025.10.20
```

### 测试2：字段映射测试

**步骤：**
1. 查看"配置字段映射"区域
2. 确认是否为每个活动子表创建了独立的映射区域

**预期结果：**
- 应该看到两个销售政策映射区域
- 每个区域标题显示子表名称和时间段
- 字段自动匹配成功

### 测试3：日期匹配测试

**步骤：**
1. 上传销售订单（包含不同日期的订单）
2. 配置字段映射
3. 点击"开始匹配"
4. 检查匹配结果

**预期结果：**
- 日期在2025.9.15-2025.10.8之间的订单，销售政策字段应来自"活动_测试1"
- 日期在2025.10.9-2025.10.20之间的订单，销售政策字段应来自"活动_测试2"
- 日期不在任何范围内的订单，销售政策字段应为空

### 测试4：边界值测试

**测试数据：**
- 订单日期 = 2025.9.15（开始日期）
- 订单日期 = 2025.10.8（结束日期）
- 订单日期 = 2025.10.9（下一时间段开始）

**预期结果：**
- 开始和结束日期都应该匹配成功
- 边界值准确匹配对应的时间段

### 测试5：控制台日志检查

**步骤：**
1. 打开浏览器开发者工具（F12）
2. 切换到Console标签
3. 重新上传政策表

**预期日志：**
```
政策表-特价机整理 读取成功: 表头行=0, 数据行数=XX
政策表-活动_测试1 读取成功: 表头行=0, 数据行数=XX, 时间段=2025.9.15 至 2025.10.8
政策表-活动_测试2 读取成功: 表头行=0, 数据行数=XX, 时间段=2025.10.9 至 2025.10.20
共加载 2 个活动子表
```

## 测试检查清单

- [ ] 政策表上传后显示活动子表数量和时间段
- [ ] 为每个活动子表创建了独立的字段映射区域
- [ ] 订单日期正确匹配对应时间段的政策
- [ ] 边界日期（开始/结束日期）匹配正确
- [ ] 不在任何时间段内的订单，销售政策字段为空
- [ ] 控制台日志显示正确的加载信息
- [ ] 导出的Excel文件包含正确的销售政策数据

## 常见问题验证

### 问题1：时间段未显示

**检查：**
- 打开政策表Excel，检查M、N列是否有数据
- 检查第一行数据的M、N列（索引12、13）
- 确认列索引正确（A=0, B=1, ..., M=12, N=13）

### 问题2：所有订单的销售政策都为空

**检查：**
- 在控制台查看是否有错误信息
- 检查订单日期格式是否正确
- 检查订单日期是否在任何政策时间段内
- 检查规格型号是否在政策表中存在

### 问题3：日期格式问题

**测试不同格式：**
- `2025.9.15`
- `2025/9/15`
- `2025-09-15`
- `2025/09/15`

所有格式都应该能正确解析。

## 性能测试

### 大数据量测试

**测试数据：**
- 销售订单：1000+行
- 活动子表：5个
- 每个活动子表：200+个型号

**检查：**
- 匹配速度是否可接受（应在几秒内完成）
- 浏览器是否卡顿
- 结果是否完整准确

## 回归测试

确保新功能不影响原有功能：

- [ ] 收款单匹配仍然正常
- [ ] 带单费匹配仍然正常
- [ ] 特价机、佳尼特、壁挂炉、标价表匹配仍然正常
- [ ] 门店筛选功能仍然正常
- [ ] 退货识别仍然正常
- [ ] 国补识别仍然正常

## 测试报告模板

```
测试时间：____________________
测试人员：____________________

功能测试结果：
□ 通过  □ 失败  原因：__________

边界值测试：
□ 通过  □ 失败  原因：__________

性能测试：
□ 通过  □ 失败  原因：__________

回归测试：
□ 通过  □ 失败  原因：__________

其他问题：
_________________________________
_________________________________
```

## 调试技巧

1. **使用控制台日志**：打开F12查看详细的加载和匹配信息
2. **断点调试**：在`findMatchingActivitySheet`函数设置断点
3. **检查索引数据**：在控制台输入`dataStore.policy.sheets.activity`查看加载的数据
4. **检查匹配结果**：在控制台输入`matchResult`查看匹配后的数据

## 下一步

测试通过后：
1. 使用实际的政策表和销售订单进行验证
2. 与提成计算工具联合测试
3. 整理使用文档和培训材料

