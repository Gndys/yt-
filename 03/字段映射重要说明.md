# 字段映射重要说明

## ⚠️ 关键修改

已将"客户"字段的映射逻辑从**客户店名**改为**用户姓名**。

## 为什么要修改?

### 原来的问题
之前的字段映射会优先匹配"客户店名"(门店名称),导致:

```
客户店名: 杭州临平江南家居专卖店
  ├─ 用户姓名: 钟正祥 (购买了 A + B)
  ├─ 用户姓名: 李四 (购买了 C + D)
  └─ 用户姓名: 王五 (购买了 E + F)
```

**错误行为**: 所有购买记录被归到同一个"客户"(门店),导致:
- ❌ 钟正祥的A+B 和 李四的C+D 可能被错误地组成套餐
- ❌ 不同客户的产品混在一起计算
- ❌ 套餐提成计算错误

### 正确的逻辑
套餐应该**按实际购买客户(用户姓名)分组**:

```
用户姓名: 钟正祥
  └─ 产品: A + B → 套餐1 ✅

用户姓名: 李四
  └─ 产品: C + D → 套餐2 ✅

用户姓名: 王五
  └─ 产品: E + F → 套餐3 ✅
```

## 字段说明

### Excel数据结构示例

| 单据编号 | **用户姓名** | 客户店名 | 规格型号 | 促销员 | 数量 |
|---------|------------|---------|---------|--------|------|
| A001 | 钟正祥 | 杭州临平江南家居专卖店 | CXW-350-Q2CWi | 余亚炜 | 1 |
| A002 | 钟正祥 | 杭州临平江南家居专卖店 | JZT-V2B2S | 余亚炜 | 1 |
| A003 | 李四 | 杭州临平江南家居专卖店 | R1600DWWi | 余亚炜 | 1 |

### 字段含义

- **用户姓名** (必需): 实际购买产品的客户姓名
  - 用于套餐分组
  - 同一客户的产品才能组成套餐
  - 别名: 客户姓名、姓名

- **客户店名** (可选): 销售门店的名称
  - 仅用于统计和展示
  - 不参与套餐计算
  - 别名: 门店名称、店名

- **促销员** (必需): 销售人员姓名
  - 用于提成归属
  - 别名: 销售员、导购

## 字段映射优先级

现在 `customerField` 的自动匹配优先级为:

1. **用户姓名** (最优先)
2. 客户姓名
3. 姓名
4. 客户名称
5. 客户

## 使用建议

### ✅ 推荐做法

1. **Excel表头使用"用户姓名"**
   ```
   单据编号 | 用户姓名 | 规格型号 | 促销员 | 数量
   ```

2. **确保同一客户的所有订单使用相同的姓名**
   - ✅ 正确: 所有记录都是"钟正祥"
   - ❌ 错误: 有的是"钟正祥",有的是"钟 正祥"(多了空格)

3. **检查字段映射**
   - 上传文件后,确认"客户姓名"字段映射到了正确的列
   - 如果自动匹配错误,手动选择正确的列

### ❌ 常见错误

1. **将"客户店名"映射到"客户姓名"字段**
   ```
   错误映射:
   客户姓名 → 客户店名列 ❌
   
   正确映射:
   客户姓名 → 用户姓名列 ✅
   ```

2. **客户姓名不一致**
   ```
   ❌ 错误:
   钟正祥
   钟 正祥  (多了空格)
   钟正祥先生
   
   ✅ 正确:
   钟正祥
   钟正祥
   钟正祥
   ```

## 验证方法

### 1. 查看控制台日志
运行"计算旧套餐"后,打开浏览器控制台(F12),应该看到:

```
=== 客户姓名: 钟正祥 (促销员: 余亚炜) ===
产品池: CXW-350-Q2CWI(1台), JZT-V2B2S(1台)
```

而不是:
```
=== 客户姓名: 杭州临平江南家居专卖店 (促销员: 余亚炜) ===  ❌ 错误!
```

### 2. 检查结果表格
在"旧套餐计算结果"表格中:
- "客户"列应该显示**客户姓名**,而不是门店名称
- 同一客户的多个套餐应该分别列出

## 影响范围

此修改影响以下功能:
- ✅ 旧套餐计算 (按客户姓名分组)
- ✅ 组合套餐政策 (按客户姓名分组)
- ✅ 活动机型政策 (按客户姓名分组)
- ✅ 导出结果 (客户列显示客户姓名)

## 迁移指南

如果你之前使用的是"客户店名"字段:

1. **检查Excel数据**
   - 确认有"用户姓名"列
   - 如果没有,需要添加此列

2. **重新映射字段**
   - 上传文件后,将"客户姓名"字段映射到"用户姓名"列
   - 不要映射到"客户店名"列

3. **重新计算**
   - 点击"解析数据"
   - 运行各项计算
   - 验证结果是否正确

## 常见问题

### Q: 如果Excel中没有"用户姓名"列怎么办?
**A**: 需要在Excel中添加此列。如果无法获取客户姓名,可以使用订单编号或其他唯一标识作为替代。

### Q: 一个客户在多个门店购买,如何处理?
**A**: 只要客户姓名相同,所有订单都会归到同一个客户下,无论在哪个门店购买。

### Q: 如果客户姓名有重复怎么办?
**A**: 如果确实有同名客户,建议在姓名后添加标识,如"张三-A"、"张三-B"。

### Q: 原来的数据还能用吗?
**A**: 如果原来的数据"客户"字段实际存储的是客户姓名,那么不受影响。如果存储的是门店名称,需要重新整理数据。
