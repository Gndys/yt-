

业务员奖金计算系统 - 详细开发说明文档

📋 目录

1. [系统概述](#系统概述)
2. [技术架构](#技术架构)
3. [功能模块设计](#功能模块设计)
4. [数据结构设计](#数据结构设计)
5. [核心算法实现](#核心算法实现)
6. [界面设计规范](#界面设计规范)
7. [开发步骤](#开发步骤)
8. [测试方案](#测试方案)
9. [部署说明](#部署说明)
  

---

系统概述

1.1 项目背景
开发一个业务员奖金计算系统，用于自动化计算月度和季度奖金，包括基础奖金、回款负激励、211厨电考核等多维度计算。

1.2 核心需求
- 支持月度奖金计算（按月份选择）
- 支持季度奖金计算（独立页面）
- 支持Excel数据导入导出
- 支持211数据在线编辑
- 自动识别试用期员工
- 标注缺失数据并跳过计算
  
1.3 用户角色
- 财务人员：主要使用者，负责上传数据和生成报表
- 管理人员：查看和审核奖金计算结果
  

---

技术架构

2.1 技术栈选择

前端框架：纯HTML + CSS + JavaScript（无需框架，降低复杂度）
Excel处理：SheetJS (xlsx.js) v0.18.5+
UI组件：原生CSS + Flexbox/Grid布局
图表库：Chart.js v3.9.1（可选，用于数据可视化）

2.2 架构设计

┌─────────────────────────────────────────┐
│           用户界面层 (UI Layer)          │
│  ┌──────────┐  ┌──────────┐  ┌────────┐ │
│  │月度计算页│  │季度计算页│  │211管理 │ │
│  └──────────┘  └──────────┘  └────────┘ │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│         业务逻辑层 (Logic Layer)         │
│  ┌──────────┐  ┌──────────┐  ┌────────┐ │
│  │数据验证  │  │奖金计算  │  │报表生成│ │
│  └──────────┘  └──────────┘  └────────┘ │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│         数据处理层 (Data Layer)          │
│  ┌──────────┐  ┌──────────┐  ┌────────┐ │
│  │Excel解析 │  │数据存储  │  │Excel导出│ │
│  └──────────┘  └──────────┘  └────────┘ │
└─────────────────────────────────────────┘

2.3 技术优势
- ✅ **纯前端**：无需后端服务器，数据安全
- ✅ **离线可用**：下载后可本地使用
- ✅ **跨平台**：支持Windows/Mac/Linux
- ✅ **易维护**：代码结构清晰，易于修改
  

---

功能模块设计

3.1 模块划分

// 核心模块结构
const System = {
  // 1. 数据管理模块
  DataManager: {
    uploadFile(),           // 文件上传
    parseExcel(),          // Excel解析
    validateData(),        // 数据验证
    storeData(),          // 数据存储
  },
  
  // 2. 计算引擎模块
  CalculationEngine: {
    calculateMonthly(),    // 月度计算
    calculateQuarterly(),  // 季度计算
    calculate211(),        // 211考核计算
    calculateIncentive(),  // 负激励计算
  },
  
  // 3. 报表生成模块
  ReportGenerator: {
    generateMonthlyReport(),   // 月度报表
    generateQuarterlyReport(), // 季度报表
    generate211Report(),       // 211报表
    exportToExcel(),          // 导出Excel
  },
  
  // 4. UI交互模块
  UIController: {
    renderTable(),         // 渲染表格
    showMessage(),        // 显示消息
    updateProgress(),     // 更新进度
    handleEvents(),       // 事件处理
  }
};

3.2 页面结构

3.2.1 月度奖金计算页面

<div class="page" id="monthly-page">
  <!-- 顶部导航 -->
  <header class="header">
    <h1>业务员奖金计算系统</h1>
    <nav class="tabs">
      <button class="tab active">月度计算</button>
      <button class="tab">季度计算</button>
      <button class="tab">211管理</button>
    </nav>
  </header>
  
  <!-- 数据上传区 -->
  <section class="upload-section">
    <h2>步骤1: 上传基础数据</h2>
    <div class="upload-grid">
      <div class="upload-item">
        <label>员工基础信息表</label>
        <input type="file" id="file-employee" accept=".xlsx,.xls">
        <span class="status">未上传</span>
      </div>
      <div class="upload-item">
        <label>任务分配表</label>
        <input type="file" id="file-task" accept=".xlsx,.xls">
        <span class="status">未上传</span>
      </div>
      <div class="upload-item">
        <label>销售员回款汇总表</label>
        <input type="file" id="file-sales" accept=".xlsx,.xls">
        <span class="status">未上传</span>
      </div>
      <div class="upload-item">
        <label>211厨电表</label>
        <input type="file" id="file-211" accept=".xlsx,.xls">
        <span class="status">未上传</span>
      </div>
    </div>
  </section>
  
  <!-- 计算参数区 -->
  <section class="param-section">
    <h2>步骤2: 选择计算月份</h2>
    <select id="month-select">
      <option value="">请选择月份</option>
      <option value="1">1月</option>
      <option value="2">2月</option>
      <!-- ... 其他月份 -->
    </select>
    <button id="btn-calculate" class="btn-primary">开始计算</button>
  </section>
  
  <!-- 结果展示区 -->
  <section class="result-section">
    <h2>计算结果</h2>
    
    <!-- Tab切换 -->
    <div class="result-tabs">
      <button class="result-tab active" data-table="monthly">月度奖金明细</button>
      <button class="result-tab" data-table="payment">回款明细</button>
      <button class="result-tab" data-table="211">211考核</button>
    </div>
    
    <!-- 表格容器 -->
    <div class="table-container">
      <div class="table-actions">
        <button id="btn-export" class="btn-secondary">导出Excel</button>
      </div>
      <div id="table-wrapper"></div>
    </div>
  </section>
</div>

3.2.2 季度奖金计算页面

<div class="page hidden" id="quarterly-page">
  <section class="upload-section">
    <h2>步骤1: 上传季度回款数据</h2>
    <div class="upload-grid">
      <div class="upload-item">
        <label>往来单位回款汇总表</label>
        <input type="file" id="file-unit-payment" accept=".xlsx,.xls">
        <span class="status">未上传</span>
      </div>
      <div class="upload-item">
        <label>销售员回款汇总表</label>
        <input type="file" id="file-sales-payment" accept=".xlsx,.xls">
        <span class="status">未上传</span>
      </div>
    </div>
  </section>
  
  <section class="param-section">
    <h2>步骤2: 选择计算季度</h2>
    <select id="quarter-select">
      <option value="">请选择季度</option>
      <option value="Q1">第一季度 (1-3月)</option>
      <option value="Q2">第二季度 (4-6月)</option>
      <option value="Q3">第三季度 (7-9月)</option>
      <option value="Q4">第四季度 (10-12月)</option>
    </select>
    <button id="btn-calculate-quarter" class="btn-primary">开始计算</button>
  </section>
  
  <section class="result-section">
    <h2>季度奖金汇总</h2>
    <div class="table-container">
      <div class="table-actions">
        <button id="btn-export-quarter" class="btn-secondary">导出Excel</button>
      </div>
      <div id="quarter-table-wrapper"></div>
    </div>
  </section>
</div>

3.2.3 211数据管理页面

<div class="page hidden" id="manage-211-page">
  <section class="upload-section">
    <h2>211厨电数据管理</h2>
    <div class="button-group">
      <button id="btn-upload-211" class="btn-secondary">上传211数据</button>
      <button id="btn-download-template" class="btn-secondary">下载模板</button>
      <button id="btn-add-row" class="btn-secondary">添加记录</button>
    </div>
    <input type="file" id="file-211-manage" accept=".xlsx,.xls" style="display:none">
  </section>
  
  <section class="edit-section">
    <h2>在线编辑</h2>
    <div class="table-container editable">
      <table id="table-211-edit">
        <thead>
          <tr>
            <th>月份</th>
            <th>具体地区</th>
            <th>业务人员</th>
            <th>任务分值</th>
            <th>完成分值</th>
            <th>备注</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody id="tbody-211-edit">
          <!-- 动态生成行 -->
        </tbody>
      </table>
    </div>
    <button id="btn-save-211" class="btn-primary">保存数据</button>
  </section>
</div>


---

数据结构设计

4.1 输入数据结构

4.1.1 员工基础信息表

// 数据结构
const employeeData = [
  {
    员工姓名: "董培培",
    标准奖金: 7000,
    所属地区: "杭州",
    业务类型: "五星",
    备注: ""  // 试用期标注
  },
  // ...
];

// 索引结构（用于快速查询）
const employeeIndex = {
  "董培培": {
    标准奖金: 7000,
    所属地区: "杭州",
    业务类型: "五星",
    是否试用期: false
  },
  // ...
};

4.1.2 任务分配表

const taskData = [
  {
    负责人: "董培培",
    区域: "汇德隆",
    "1月": 27,
    "2月": 21,
    "3月": 120,
    // ... 其他月份
    Q1: 168,
    // ... 其他季度
  },
  // ...
];

// 索引结构
const taskIndex = {
  "董培培": {
    "1": 270000,  // 转换为元
    "2": 210000,
    // ...
    "Q1": 1680000,
    // ...
  },
  // ...
};

4.1.3 销售员回款汇总表

const salesData = [
  {
    销售员: "董培培",
    销售组织: "杭州中冠电器有限公司",
    销售部门: "杭州大区",
    总收款: 433809.0,
    总退款: 8090.0,
    回款: 425719.0
  },
  // ...
];

// 月度回款索引
const paymentIndex = {
  "董培培": {
    "1": 425719.0,
    "2": 350000.0,
    // ...
  },
  // ...
};

4.1.4 211厨电表

const exam211Data = [
  {
    月份: "1",
    具体地区: "汇德隆",
    业务人员: "董培培",
    任务: 15,
    完成: 1,
    备注: "任务15分，完成1分"
  },
  // ...
];

// 索引结构
const exam211Index = {
  "董培培": {
    "1": { 任务: 15, 完成: 1 },
    "2": { 任务: 15, 完成: 2 },
    // ...
  },
  // ...
};

4.2 输出数据结构

4.2.1 月度奖金明细表

const monthlyReport = [
  {
    业务员: "董培培",
    地区: "杭州",
    月份: "8月",
    任务: 400000,
    回款: 200020,
    完成率: "50.01%",
    基础奖金: 2450.49,
    回款负激励: 700,
    负激励211: 800,
    实发奖金: 950.49,
    个税: 0,
    备注: "完成率50%-80%，扣10%",
    数据状态: "完整"  // 或 "缺失任务数据"
  },
  // ...
];

4.2.2 季度奖金汇总表

const quarterlyReport = [
  {
    业务员: "董培培",
    季度: "Q3",
    季度任务: 1380000,
    季度回款: 842600,
    完成率: "61.07%",
    基础奖金: 3847.41,
    返还金额: 0,
    实发奖金: 3847.41,
    备注: "季度完成率达标"
  },
  // ...
];

4.3 数据存储结构

// 全局数据存储对象
const AppData = {
  // 原始数据
  raw: {
    employee: null,    // 员工信息
    task: null,        // 任务分配
    sales: null,       // 销售回款
    exam211: null      // 211考核
  },
  
  // 索引数据（用于快速查询）
  index: {
    employee: {},
    task: {},
    sales: {},
    exam211: {}
  },
  
  // 计算结果
  results: {
    monthly: [],       // 月度结果
    quarterly: [],     // 季度结果
    payment: [],       // 回款明细
    exam211: []        // 211明细
  },
  
  // 配置参数
  config: {
    selectedMonth: null,
    selectedQuarter: null,
    标准奖金月度占比: 0.7,
    标准奖金季度占比: 0.3,
    考核211基数: 800
  }
};


---

核心算法实现

5.1 月度奖金计算算法

/**
 * 计算单个业务员的月度奖金
 * @param {string} employeeName - 业务员姓名
 * @param {string} month - 月份 (1-12)
 * @returns {Object} 计算结果
 */
function calculateMonthlyBonus(employeeName, month) {
  // 1. 获取基础信息
  const employee = AppData.index.employee[employeeName];
  if (!employee) {
    return { error: "员工信息不存在" };
  }
  
  const 标准奖金 = employee.标准奖金;
  const 地区 = employee.所属地区;
  const 是否试用期 = employee.是否试用期;
  
  // 2. 获取任务和回款
  const 任务 = AppData.index.task[employeeName]?.[month];
  const 回款 = AppData.index.sales[employeeName]?.[month];
  
  // 3. 数据完整性检查
  if (任务 === undefined || 回款 === undefined) {
    return {
      业务员: employeeName,
      地区: 地区,
      月份: `${month}月`,
      数据状态: "数据缺失",
      备注: `缺失${任务 === undefined ? '任务' : ''}${回款 === undefined ? '回款' : ''}数据`
    };
  }
  
  // 4. 试用期员工特殊处理
  if (是否试用期) {
    return {
      业务员: employeeName,
      地区: 地区,
      月份: `${month}月`,
      任务: 任务,
      回款: 回款,
      完成率: formatPercent(回款 / 任务),
      基础奖金: 0,
      回款负激励: 0,
      负激励211: 0,
      实发奖金: 0,
      个税: 0,
      备注: "试用期无考核奖金，负激励不扣",
      数据状态: "完整"
    };
  }
  
  // 5. 计算完成率
  const 完成率 = 回款 / 任务;
  
  // 6. 计算基础奖金
  const 基础奖金 = 标准奖金 * 0.7 * 完成率;
  
  // 7. 计算回款负激励（仅杭州地区）
  let 回款负激励 = 0;
  let 负激励说明 = "";
  
  if (地区 === "杭州") {
    if (完成率 < 0.5) {
      回款负激励 = 标准奖金 * 0.2;
      负激励说明 = "完成率<50%，扣20%";
    } else if (完成率 < 0.8) {
      回款负激励 = 标准奖金 * 0.1;
      负激励说明 = "完成率50%-80%，扣10%";
    } else {
      负激励说明 = "完成率≥80%，不扣款";
    }
  } else {
    负激励说明 = "非杭州地区";
  }
  
  // 8. 计算211负激励
  const exam211 = AppData.index.exam211[employeeName]?.[month];
  let 负激励211 = 0;
  
  if (exam211) {
    const { 任务: 任务分值, 完成: 完成分值 } = exam211;
    负激励211 = 800 - (完成分值 / 任务分值) * 800;
  } else {
    // 没有211考核记录，默认扣800
    负激励211 = 800;
  }
  
  // 9. 计算实发奖金
  const 实发奖金 = 基础奖金 - 回款负激励 - 负激励211;
  
  // 10. 返回结果
  return {
    业务员: employeeName,
    地区: 地区,
    月份: `${month}月`,
    任务: 任务,
    回款: 回款,
    完成率: formatPercent(完成率),
    基础奖金: roundMoney(基础奖金),
    回款负激励: roundMoney(回款负激励),
    负激励211: roundMoney(负激励211),
    实发奖金: roundMoney(实发奖金),
    个税: 0,
    备注: 负激励说明,
    数据状态: "完整"
  };
}

5.2 季度奖金计算算法

/**
 * 计算单个业务员的季度奖金
 * @param {string} employeeName - 业务员姓名
 * @param {string} quarter - 季度 (Q1/Q2/Q3/Q4)
 * @returns {Object} 计算结果
 */
function calculateQuarterlyBonus(employeeName, quarter) {
  // 1. 获取基础信息
  const employee = AppData.index.employee[employeeName];
  if (!employee) {
    return { error: "员工信息不存在" };
  }
  
  const 标准奖金 = employee.标准奖金;
  const 地区 = employee.所属地区;
  const 是否试用期 = employee.是否试用期;
  
  // 2. 确定季度月份
  const quarterMonths = {
    'Q1': ['1', '2', '3'],
    'Q2': ['4', '5', '6'],
    'Q3': ['7', '8', '9'],
    'Q4': ['10', '11', '12']
  };
  const months = quarterMonths[quarter];
  
  // 3. 汇总季度任务和回款
  let 季度任务 = 0;
  let 季度回款 = 0;
  let 数据完整 = true;
  
  for (const month of months) {
    const 任务 = AppData.index.task[employeeName]?.[month];
    const 回款 = AppData.index.sales[employeeName]?.[month];
    
    if (任务 === undefined || 回款 === undefined) {
      数据完整 = false;
      break;
    }
    
    季度任务 += 任务;
    季度回款 += 回款;
  }
  
  if (!数据完整) {
    return {
      业务员: employeeName,
      季度: quarter,
      数据状态: "数据缺失",
      备注: "季度数据不完整"
    };
  }
  
  // 4. 试用期员工特殊处理
  if (是否试用期) {
    return {
      业务员: employeeName,
      季度: quarter,
      季度任务: 季度任务,
      季度回款: 季度回款,
      完成率: formatPercent(季度回款 / 季度任务),
      基础奖金: 0,
      返还金额: 0,
      实发奖金: 0,
      备注: "试用期无季度奖金",
      数据状态: "完整"
    };
  }
  
  // 5. 计算季度完成率
  const 季度完成率 = 季度回款 / 季度任务;
  
  // 6. 计算基础奖金
  let 基础奖金 = 0;
  let 备注 = "";
  
  // 杭州地区红线规则
  if (地区 === "杭州" && 季度完成率 < 0.5) {
    基础奖金 = 0;
    备注 = "触发红线，季度完成率<50%，季度奖金归零";
  } else {
    基础奖金 = 标准奖金 * 0.3 * 3 * 季度完成率;
    备注 = `季度完成率${formatPercent(季度完成率)}`;
  }
  
  // 7. 计算返还金额（仅杭州地区，完成率≥80%）
  let 返还金额 = 0;
  
  if (地区 === "杭州" && 季度完成率 >= 0.8) {
    // 计算该季度每个月的回款负激励
    for (const month of months) {
      const 任务 = AppData.index.task[employeeName][month];
      const 回款 = AppData.index.sales[employeeName][month];
      const 月完成率 = 回款 / 任务;
      
      if (月完成率 < 0.5) {
        返还金额 += 标准奖金 * 0.2;
      } else if (月完成率 < 0.8) {
        返还金额 += 标准奖金 * 0.1;
      }
    }
    
    if (返还金额 > 0) {
      备注 += "，返还月度负激励";
    }
  }
  
  // 8. 计算实发奖金
  const 实发奖金 = 基础奖金 + 返还金额;
  
  // 9. 返回结果
  return {
    业务员: employeeName,
    季度: quarter,
    季度任务: 季度任务,
    季度回款: 季度回款,
    完成率: formatPercent(季度完成率),
    基础奖金: roundMoney(基础奖金),
    返还金额: roundMoney(返还金额),
    实发奖金: roundMoney(实发奖金),
    备注: 备注,
    数据状态: "完整"
  };
}

5.3 211考核计算算法

/**
 * 计算211负激励
 * @param {string} employeeName - 业务员姓名
 * @param {string} month - 月份
 * @returns {Object} 计算结果
 */
function calculate211Penalty(employeeName, month) {
  const exam211 = AppData.index.exam211[employeeName]?.[month];
  
  if (!exam211) {
    return {
      业务员: employeeName,
      月份: `${month}月`,
      目标分值: 0,
      完成分值: 0,
      完成率: "0%",
      扣款金额: 800,
      备注: "无考核记录，扣800元"
    };
  }
  
  const { 任务: 目标分值, 完成: 完成分值, 备注 } = exam211;
  const 完成率 = 完成分值 / 目标分值;
  const 扣款金额 = 800 - (完成分值 / 目标分值) * 800;
  
  return {
    业务员: employeeName,
    月份: `${month}月`,
    目标分值: 目标分值,
    完成分值: 完成分值,
    完成率: formatPercent(完成率),
    扣款金额: roundMoney(扣款金额),
    备注: 备注 || `完成${完成分值}/${目标分值}分`
  };
}

5.4 辅助函数

/**
 * 格式化百分比
 */
function formatPercent(value) {
  return (value * 100).toFixed(2) + '%';
}

/**
 * 金额四舍五入
 */
function roundMoney(value) {
  return Math.round(value * 100) / 100;
}

/**
 * 格式化金额（添加千分位）
 */
function formatMoney(value) {
  return value.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
}

/**
 * 判断是否为试用期员工
 */
function isTrialEmployee(employee) {
  const 备注 = employee.备注 || '';
  return 备注.includes('试用期') || 备注.includes('试用');
}


---
核心算法实现（续）

5.5 数据验证算法

/**
 * 验证上传的Excel数据
 * @param {Object} data - 解析后的数据
 * @param {string} type - 数据类型 (employee/task/sales/exam211)
 * @returns {Object} 验证结果
 */
function validateData(data, type) {
  const validationRules = {
    employee: {
      requiredColumns: ['员工姓名', '标准奖金', '所属地区', '业务类型'],
      columnTypes: {
        '员工姓名': 'string',
        '标准奖金': 'number',
        '所属地区': 'string',
        '业务类型': 'string'
      }
    },
    task: {
      requiredColumns: ['负责人', '区域', '1月', '2月', '3月'],
      columnTypes: {
        '负责人': 'string',
        '区域': 'string',
        '1月': 'number'
      }
    },
    sales: {
      requiredColumns: ['销售员', '总收款', '总退款', '回款'],
      columnTypes: {
        '销售员': 'string',
        '回款': 'number'
      }
    },
    exam211: {
      requiredColumns: ['月份', '业务人员', '任务', '完成'],
      columnTypes: {
        '月份': 'string',
        '业务人员': 'string',
        '任务': 'number',
        '完成': 'number'
      }
    }
  };
  
  const rules = validationRules[type];
  if (!rules) {
    return { valid: false, error: '未知的数据类型' };
  }
  
  // 检查数据是否为空
  if (!data || data.length === 0) {
    return { valid: false, error: '数据为空' };
  }
  
  // 检查必需列
  const firstRow = data[0];
  const missingColumns = rules.requiredColumns.filter(
    col => !(col in firstRow)
  );
  
  if (missingColumns.length > 0) {
    return { 
      valid: false, 
      error: `缺少必需列: ${missingColumns.join(', ')}` 
    };
  }
  
  // 检查数据类型
  const typeErrors = [];
  data.forEach((row, index) => {
    for (const [col, expectedType] of Object.entries(rules.columnTypes)) {
      const value = row[col];
      if (value === null || value === undefined) continue;
      
      if (expectedType === 'number' && typeof value !== 'number') {
        typeErrors.push(`第${index + 2}行"${col}"应为数字`);
      }
      if (expectedType === 'string' && typeof value !== 'string') {
        typeErrors.push(`第${index + 2}行"${col}"应为文本`);
      }
    }
  });
  
  if (typeErrors.length > 0) {
    return { 
      valid: false, 
      error: `数据类型错误:\n${typeErrors.slice(0, 5).join('\n')}` 
    };
  }
  
  // 检查重复数据
  const keyColumn = type === 'employee' ? '员工姓名' : 
                    type === 'task' ? '负责人' : 
                    type === 'sales' ? '销售员' : '业务人员';
  
  const keys = data.map(row => row[keyColumn]);
  const duplicates = keys.filter((key, index) => keys.indexOf(key) !== index);
  
  if (duplicates.length > 0) {
    return { 
      valid: false, 
      error: `存在重复数据: ${[...new Set(duplicates)].join(', ')}` 
    };
  }
  
  return { valid: true };
}

5.6 数据索引构建算法

/**
 * 构建员工信息索引
 */
function buildEmployeeIndex(data) {
  const index = {};
  
  data.forEach(row => {
    const name = row['员工姓名'];
    index[name] = {
      标准奖金: row['标准奖金'],
      所属地区: row['所属地区'],
      业务类型: row['业务类型'],
      备注: row['备注'] || '',
      是否试用期: isTrialEmployee(row)
    };
  });
  
  return index;
}

/**
 * 构建任务索引
 */
function buildTaskIndex(data) {
  const index = {};
  const months = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'];
  
  data.forEach(row => {
    const name = row['负责人'];
    index[name] = {};
    
    // 处理月度任务（假设单位是万元，需要转换为元）
    months.forEach(month => {
      const value = row[`${month}月`];
      if (value !== undefined && value !== null) {
        index[name][month] = value * 10000; // 万元转元
      }
    });
    
    // 处理季度任务
    ['Q1', 'Q2', 'Q3', 'Q4'].forEach(quarter => {
      const value = row[quarter];
      if (value !== undefined && value !== null) {
        index[name][quarter] = value * 10000;
      }
    });
  });
  
  return index;
}

/**
 * 构建回款索引
 */
function buildSalesIndex(data) {
  const index = {};
  const months = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'];
  
  data.forEach(row => {
    const name = row['销售员'];
    if (!index[name]) {
      index[name] = {};
    }
    
    // 如果有月度列，直接读取
    months.forEach(month => {
      const value = row[`${month}月`];
      if (value !== undefined && value !== null) {
        index[name][month] = value;
      }
    });
    
    // 如果只有总回款，需要根据实际情况分配
    if (!index[name]['1'] && row['回款']) {
      // 这里需要根据实际Excel结构调整
      index[name]['total'] = row['回款'];
    }
  });
  
  return index;
}

/**
 * 构建211考核索引
 */
function build211Index(data) {
  const index = {};
  
  data.forEach(row => {
    const name = row['业务人员'];
    const month = String(row['月份']).replace(/[月]/g, ''); // 移除"月"字
    
    if (!index[name]) {
      index[name] = {};
    }
    
    index[name][month] = {
      任务: row['任务'] || row['目标分值'] || 10,
      完成: row['完成'] || row['完成分值'] || 0,
      备注: row['备注'] || ''
    };
  });
  
  return index;
}


---

界面设计规范

6.1 设计原则

- 简洁明了：界面清晰，操作流程一目了然
- 响应式设计：支持不同屏幕尺寸
- 视觉反馈：操作有明确的反馈提示
- 容错性：友好的错误提示和数据验证
  
6.2 色彩方案

:root {
  /* 主色调 */
  --primary-color: #1890ff;      /* 主要按钮、链接 */
  --primary-hover: #40a9ff;      /* 悬停状态 */
  --primary-active: #096dd9;     /* 激活状态 */
  
  /* 辅助色 */
  --success-color: #52c41a;      /* 成功提示 */
  --warning-color: #faad14;      /* 警告提示 */
  --error-color: #f5222d;        /* 错误提示 */
  --info-color: #1890ff;         /* 信息提示 */
  
  /* 中性色 */
  --text-primary: #262626;       /* 主要文本 */
  --text-secondary: #8c8c8c;     /* 次要文本 */
  --text-disabled: #bfbfbf;      /* 禁用文本 */
  
  /* 背景色 */
  --bg-primary: #ffffff;         /* 主背景 */
  --bg-secondary: #fafafa;       /* 次背景 */
  --bg-hover: #f5f5f5;          /* 悬停背景 */
  
  /* 边框色 */
  --border-color: #d9d9d9;       /* 默认边框 */
  --border-light: #f0f0f0;       /* 浅色边框 */
  
  /* 阴影 */
  --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
  --shadow-md: 0 4px 12px rgba(0,0,0,0.12);
  --shadow-lg: 0 8px 24px rgba(0,0,0,0.16);
}

6.3 布局规范

/* 容器宽度 */
.container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 24px;
}

/* 间距规范 */
.spacing-xs { margin: 8px; }
.spacing-sm { margin: 16px; }
.spacing-md { margin: 24px; }
.spacing-lg { margin: 32px; }
.spacing-xl { margin: 48px; }

/* 圆角规范 */
.radius-sm { border-radius: 4px; }
.radius-md { border-radius: 8px; }
.radius-lg { border-radius: 12px; }

6.4 组件样式

6.4.1 按钮组件

/* 主要按钮 */
.btn-primary {
  padding: 10px 24px;
  background: var(--primary-color);
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-primary:hover {
  background: var(--primary-hover);
  box-shadow: var(--shadow-sm);
}

.btn-primary:active {
  background: var(--primary-active);
}

.btn-primary:disabled {
  background: #d9d9d9;
  color: rgba(0,0,0,0.25);
  cursor: not-allowed;
}

/* 次要按钮 */
.btn-secondary {
  padding: 10px 24px;
  background: white;
  color: var(--text-primary);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-secondary:hover {
  color: var(--primary-color);
  border-color: var(--primary-color);
}

6.4.2 表格组件

.table-container {
  background: white;
  border-radius: 8px;
  box-shadow: var(--shadow-sm);
  overflow: hidden;
}

.data-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

.data-table thead {
  background: #fafafa;
}

.data-table th {
  padding: 16px;
  text-align: left;
  font-weight: 600;
  color: var(--text-primary);
  border-bottom: 1px solid var(--border-light);
}

.data-table td {
  padding: 16px;
  border-bottom: 1px solid var(--border-light);
  color: var(--text-secondary);
}

.data-table tbody tr:hover {
  background: var(--bg-hover);
}

/* 数据状态样式 */
.status-complete { color: var(--success-color); }
.status-missing { color: var(--error-color); }
.status-trial { color: var(--warning-color); }

6.4.3 上传组件

.upload-item {
  padding: 24px;
  border: 2px dashed var(--border-color);
  border-radius: 8px;
  text-align: center;
  transition: all 0.3s;
  cursor: pointer;
}

.upload-item:hover {
  border-color: var(--primary-color);
  background: #f0f7ff;
}

.upload-item.uploaded {
  border-color: var(--success-color);
  background: #f6ffed;
}

.upload-item label {
  display: block;
  font-size: 14px;
  font-weight: 500;
  margin-bottom: 12px;
  color: var(--text-primary);
}

.upload-item .status {
  display: inline-block;
  margin-top: 8px;
  font-size: 12px;
  color: var(--text-secondary);
}

.upload-item .status.success {
  color: var(--success-color);
}

6.4.4 消息提示组件

.message {
  position: fixed;
  top: 24px;
  left: 50%;
  transform: translateX(-50%);
  padding: 12px 24px;
  border-radius: 4px;
  box-shadow: var(--shadow-md);
  font-size: 14px;
  z-index: 9999;
  animation: slideDown 0.3s ease;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
}

.message.success {
  background: #f6ffed;
  border: 1px solid #b7eb8f;
  color: #52c41a;
}

.message.error {
  background: #fff2f0;
  border: 1px solid #ffccc7;
  color: #f5222d;
}

.message.warning {
  background: #fffbe6;
  border: 1px solid #ffe58f;
  color: #faad14;
}

.message.info {
  background: #e6f7ff;
  border: 1px solid #91d5ff;
  color: #1890ff;
}

6.5 响应式设计

/* 桌面端 (>1200px) */
@media (min-width: 1200px) {
  .upload-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 24px;
  }
}

/* 平板端 (768px - 1200px) */
@media (min-width: 768px) and (max-width: 1199px) {
  .upload-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }
}

/* 移动端 (<768px) */
@media (max-width: 767px) {
  .upload-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
  }
  
  .container {
    padding: 0 16px;
  }
  
  .data-table {
    font-size: 12px;
  }
  
  .data-table th,
  .data-table td {
    padding: 8px;
  }
}


---

开发步骤

7.1 第一阶段：基础框架搭建（2小时）

任务清单
[] 创建HTML基础结构
[] 编写CSS样式系统
[] 实现页面切换功能
[] 集成SheetJS库

代码示例

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>业务员奖金计算系统 v1.0</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    /* 在这里插入所有CSS代码 */
  </style>
</head>
<body>
  <div id="app">
    <!-- 页面内容 -->
  </div>
  
  <script>
    // 全局数据存储
    const AppData = {
      raw: {},
      index: {},
      results: {},
      config: {}
    };
    
    // 页面切换功能
    function switchPage(pageName) {
      document.querySelectorAll('.page').forEach(page => {
        page.classList.add('hidden');
      });
      document.getElementById(`${pageName}-page`).classList.remove('hidden');
      
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      event.target.classList.add('active');
    }
    
    // 初始化
    document.addEventListener('DOMContentLoaded', function() {
      console.log('系统初始化完成');
    });
  </script>
</body>
</html>

7.2 第二阶段：Excel处理功能（3小时）

任务清单
[] 实现文件上传功能
[] 实现Excel解析功能
[] 实现数据验证功能
[] 实现数据索引构建

代码示例

/**
 * 文件上传处理
 */
function handleFileUpload(event, dataType) {
  const file = event.target.files[0];
  if (!file) return;
  
  showMessage('正在读取文件...', 'info');
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      // 解析Excel
      const data = e.target.result;
      const workbook = XLSX.read(data, { type: 'binary' });
      const sheetName = workbook.SheetNames[0];
      const worksheet = workbook.Sheets[sheetName];
      const jsonData = XLSX.utils.sheet_to_json(worksheet);
      
      // 验证数据
      const validation = validateData(jsonData, dataType);
      if (!validation.valid) {
        showMessage(`数据验证失败: ${validation.error}`, 'error');
        return;
      }
      
      // 存储原始数据
      AppData.raw[dataType] = jsonData;
      
      // 构建索引
      switch(dataType) {
        case 'employee':
          AppData.index.employee = buildEmployeeIndex(jsonData);
          break;
        case 'task':
          AppData.index.task = buildTaskIndex(jsonData);
          break;
        case 'sales':
          AppData.index.sales = buildSalesIndex(jsonData);
          break;
        case 'exam211':
          AppData.index.exam211 = build211Index(jsonData);
          break;
      }
      
      // 更新UI状态
      updateUploadStatus(dataType, true);
      showMessage(`${getDataTypeName(dataType)}上传成功！`, 'success');
      
    } catch (error) {
      console.error('文件解析错误:', error);
      showMessage('文件解析失败，请检查文件格式', 'error');
    }
  };
  
  reader.readAsBinaryString(file);
}

/**
 * 更新上传状态
 */
function updateUploadStatus(dataType, success) {
  const fileInput = document.getElementById(`file-${dataType}`);
  const uploadItem = fileInput.closest('.upload-item');
  const statusSpan = uploadItem.querySelector('.status');
  
  if (success) {
    uploadItem.classList.add('uploaded');
    statusSpan.textContent = '✓ 已上传';
    statusSpan.classList.add('success');
  } else {
    uploadItem.classList.remove('uploaded');
    statusSpan.textContent = '未上传';
    statusSpan.classList.remove('success');
  }
}

/**
 * 获取数据类型名称
 */
function getDataTypeName(dataType) {
  const names = {
    'employee': '员工基础信息表',
    'task': '任务分配表',
    'sales': '销售员回款汇总表',
    'exam211': '211厨电表'
  };
  return names[dataType] || dataType;
}

7.3 第三阶段：计算功能实现（4小时）

任务清单
[] 实现月度奖金计算
[] 实现季度奖金计算
[] 实现211考核计算
[] 实现批量计算功能

代码示例

/**
 * 开始月度计算
 */
function startMonthlyCalculation() {
  // 1. 检查数据完整性
  if (!checkDataReady(['employee', 'task', 'sales', 'exam211'])) {
    showMessage('请先上传所有必需的数据文件', 'warning');
    return;
  }
  
  // 2. 获取选择的月份
  const month = document.getElementById('month-select').value;
  if (!month) {
    showMessage('请选择计算月份', 'warning');
    return;
  }
  
  // 3. 开始计算
  showMessage('正在计算，请稍候...', 'info');
  
  setTimeout(() => {
    try {
      // 获取所有业务员
      const employees = Object.keys(AppData.index.employee);
      
      // 批量计算
      const results = employees.map(name => 
        calculateMonthlyBonus(name, month)
      );
      
      // 存储结果
      AppData.results.monthly = results;
      
      // 生成其他报表
      AppData.results.payment = generatePaymentReport(month);
      AppData.results.exam211 = generate211Report(month);
      
      // 渲染表格
      renderMonthlyReport();
      
      showMessage('计算完成！', 'success');
      
    } catch (error) {
      console.error('计算错误:', error);
      showMessage('计算过程中出现错误', 'error');
    }
  }, 100);
}

/**
 * 检查数据是否准备就绪
 */
function checkDataReady(requiredTypes) {
  for (const type of requiredTypes) {
    if (!AppData.raw[type] || AppData.raw[type].length === 0) {
      return false;
    }
  }
  return true;
}

/**
 * 生成回款明细报表
 */
function generatePaymentReport(month) {
  const results = [];
  
  for (const [name, payments] of Object.entries(AppData.index.sales)) {
    if (payments[month] !== undefined) {
      const employee = AppData.index.employee[name];
      results.push({
        业务员: name,
        门店: employee?.所属地区 || '-',
        月份: `${month}月`,
        回款金额: payments[month]
      });
    }
  }
  
  return results;
}

/**
 * 生成211考核报表
 */
function generate211Report(month) {
  const results = [];
  
  for (const [name, exams] of Object.entries(AppData.index.exam211)) {
    if (exams[month]) {
      results.push(calculate211Penalty(name, month));
    }
  }
  
  return results;
}

7.4 第四阶段：UI渲染功能（2小时）

任务清单
[] 实现表格渲染功能
[] 实现数据高亮显示
[] 实现排序和筛选
[] 实现导出功能

代码示例

/**
 * 渲染月度奖金报表
 */
function renderMonthlyReport() {
  const data = AppData.results.monthly;
  if (!data || data.length === 0) {
    showMessage('没有数据可显示', 'warning');
    return;
  }
  
  const tableHtml = `
    <table class="data-table">
      <thead>
        <tr>
          <th>业务员</th>
          <th>地区</th>
          <th>月份</th>
          <th>任务(元)</th>
          <th>回款(元)</th>
          <th>完成率</th>
          <th>基础奖金</th>
          <th>回款负激励</th>
          <th>211负激励</th>
          <th>实发奖金</th>
          <th>个税</th>
          <th>备注</th>
        </tr>
      </thead>
      <tbody>
        ${data.map(row => renderTableRow(row)).join('')}
      </tbody>
    </table>
  `;
  
  document.getElementById('table-wrapper').innerHTML = tableHtml;
}

/**
 * 渲染表格行
 */
function renderTableRow(row) {
  // 根据数据状态添加样式类
  const statusClass = row.数据状态 === '完整' ? 'status-complete' : 
                      row.数据状态 === '数据缺失' ? 'status-missing' : 
                      'status-trial';
  
  // 高亮显示负数
  const highlightNegative = (value) => {
    if (typeof value === 'number' && value < 0) {
      return `<span style="color: var(--error-color)">${formatMoney(value)}</span>`;
    }
    return typeof value === 'number' ? formatMoney(value) : value;
  };
  
  return `
    <tr class="${statusClass}">
      <td>${row.业务员}</td>
      <td>${row.地区}</td>
      <td>${row.月份}</td>
      <td>${row.任务 ? formatMoney(row.任务) : '-'}</td>
      <td>${row.回款 ? formatMoney(row.回款) : '-'}</td>
      <td>${row.完成率 || '-'}</td>
      <td>${highlightNegative(row.基础奖金)}</td>
      <td>${highlightNegative(row.回款负激励)}</td>
      <td>${highlightNegative(row.负激励211)}</td>
      <td><strong>${highlightNegative(row.实发奖金)}</strong></td>
      <td>${row.个税 || 0}</td>
      <td>${row.备注 || '-'}</td>
    </tr>
  `;
}

/**
 * 导出Excel
 */
function exportToExcel() {
  const data = AppData.results.monthly;
  if (!data || data.length === 0) {
    showMessage('没有数据可导出', 'warning');
    return;
  }
  
  try {
    // 创建工作簿
    const wb = XLSX.utils.book_new();
    
    // 月度奖金明细
    const ws1 = XLSX.utils.json_to_sheet(data);
    XLSX.utils.book_append_sheet(wb, ws1, '月度奖金明细');
    
    // 回款明细
    if (AppData.results.payment) {
      const ws2 = XLSX.utils.json_to_sheet(AppData.results.payment);
      XLSX.utils.book_append_sheet(wb, ws2, '回款明细');
    }
    
    // 211考核
    if (AppData.results.exam211) {
      const ws3 = XLSX.utils.json_to_sheet(AppData.results.exam211);
      XLSX.utils.book_append_sheet(wb, ws3, '211考核');
    }
    
    // 生成文件名
    const month = document.getElementById('month-select').value;
    const filename = `奖金计算结果_${month}月_${new Date().toLocaleDateString()}.xlsx`;
    
    // 下载
    XLSX.writeFile(wb, filename);
    
    showMessage('导出成功！', 'success');
    
  } catch (error) {
    console.error('导出错误:', error);
    showMessage('导出失败', 'error');
  }
}

7.5 第五阶段：211管理功能（2小时）

任务清单
[] 实现211数据在线编辑
- [

] 实现211数据添加/删除
[] 实现211模板下载
[] 实现211数据保存

代码示例

/**
 * 渲染211编辑表格
 */
function render211EditTable() {
  const data = AppData.raw.exam211 || [];
  
  const tableHtml = `
    <table class="data-table editable" id="table-211-edit">
      <thead>
        <tr>
          <th>月份</th>
          <th>具体地区</th>
          <th>业务人员</th>
          <th>任务分值</th>
          <th>完成分值</th>
          <th>备注</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody id="tbody-211-edit">
        ${data.map((row, index) => render211EditRow(row, index)).join('')}
      </tbody>
    </table>
  `;
  
  document.querySelector('.edit-section .table-container').innerHTML = tableHtml;
}

/**
 * 渲染211编辑行
 */
function render211EditRow(row, index) {
  return `
    <tr data-index="${index}">
      <td>
        <select class="edit-input" data-field="月份">
          ${generateMonthOptions(row.月份)}
        </select>
      </td>
      <td>
        <input type="text" class="edit-input" data-field="具体地区" 
               value="${row.具体地区 || ''}" placeholder="输入地区">
      </td>
      <td>
        <select class="edit-input" data-field="业务人员">
          ${generateEmployeeOptions(row.业务人员)}
        </select>
      </td>
      <td>
        <input type="number" class="edit-input" data-field="任务" 
               value="${row.任务 || 10}" min="0" step="1">
      </td>
      <td>
        <input type="number" class="edit-input" data-field="完成" 
               value="${row.完成 || 0}" min="0" step="0.1">
      </td>
      <td>
        <input type="text" class="edit-input" data-field="备注" 
               value="${row.备注 || ''}" placeholder="备注信息">
      </td>
      <td>
        <button class="btn-icon" onclick="delete211Row(${index})" title="删除">
          🗑️
        </button>
      </td>
    </tr>
  `;
}

/**
 * 生成月份选项
 */
function generateMonthOptions(selectedMonth) {
  const months = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'];
  return months.map(m => 
    `<option value="${m}" ${m === String(selectedMonth) ? 'selected' : ''}>${m}月</option>`
  ).join('');
}

/**
 * 生成业务员选项
 */
function generateEmployeeOptions(selectedEmployee) {
  const employees = Object.keys(AppData.index.employee || {});
  let options = '<option value="">请选择</option>';
  
  options += employees.map(name => 
    `<option value="${name}" ${name === selectedEmployee ? 'selected' : ''}>${name}</option>`
  ).join('');
  
  return options;
}

/**
 * 添加211记录
 */
function add211Row() {
  if (!AppData.raw.exam211) {
    AppData.raw.exam211 = [];
  }
  
  const newRow = {
    月份: '1',
    具体地区: '',
    业务人员: '',
    任务: 10,
    完成: 0,
    备注: ''
  };
  
  AppData.raw.exam211.push(newRow);
  render211EditTable();
  
  // 滚动到底部
  const tbody = document.getElementById('tbody-211-edit');
  tbody.lastElementChild.scrollIntoView({ behavior: 'smooth' });
  
  showMessage('已添加新记录', 'success');
}

/**
 * 删除211记录
 */
function delete211Row(index) {
  if (!confirm('确定要删除这条记录吗？')) {
    return;
  }
  
  AppData.raw.exam211.splice(index, 1);
  render211EditTable();
  showMessage('已删除记录', 'success');
}

/**
 * 保存211数据
 */
function save211Data() {
  const tbody = document.getElementById('tbody-211-edit');
  const rows = tbody.querySelectorAll('tr');
  const newData = [];
  
  rows.forEach(row => {
    const data = {};
    row.querySelectorAll('.edit-input').forEach(input => {
      const field = input.dataset.field;
      let value = input.value;
      
      // 类型转换
      if (field === '任务' || field === '完成') {
        value = parseFloat(value) || 0;
      } else if (field === '月份') {
        value = String(value).replace(/[月]/g, '');
      }
      
      data[field] = value;
    });
    
    newData.push(data);
  });
  
  // 验证数据
  const invalidRows = newData.filter(row => 
    !row.业务人员 || !row.月份
  );
  
  if (invalidRows.length > 0) {
    showMessage('请填写完整的业务人员和月份信息', 'warning');
    return;
  }
  
  // 保存数据
  AppData.raw.exam211 = newData;
  AppData.index.exam211 = build211Index(newData);
  
  showMessage('保存成功！', 'success');
}

/**
 * 下载211模板
 */
function download211Template() {
  const template = [
    {
      月份: '1',
      具体地区: '示例地区',
      业务人员: '示例员工',
      任务: 10,
      完成: 8,
      备注: '试用期员工请在此标注'
    }
  ];
  
  const ws = XLSX.utils.json_to_sheet(template);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, '211厨电模板');
  
  // 设置列宽
  ws['!cols'] = [
    { wch: 10 },  // 月份
    { wch: 15 },  // 具体地区
    { wch: 15 },  // 业务人员
    { wch: 12 },  // 任务
    { wch: 12 },  // 完成
    { wch: 30 }   // 备注
  ];
  
  XLSX.writeFile(wb, '211厨电考核模板.xlsx');
  showMessage('模板下载成功！', 'success');
}

/**
 * 上传211数据（管理页面）
 */
function upload211ForManage() {
  document.getElementById('file-211-manage').click();
}

/**
 * 处理211文件上传（管理页面）
 */
function handle211FileUpload(event) {
  const file = event.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = e.target.result;
      const workbook = XLSX.read(data, { type: 'binary' });
      const sheetName = workbook.SheetNames[0];
      const worksheet = workbook.Sheets[sheetName];
      const jsonData = XLSX.utils.sheet_to_json(worksheet);
      
      // 验证数据
      const validation = validateData(jsonData, 'exam211');
      if (!validation.valid) {
        showMessage(`数据验证失败: ${validation.error}`, 'error');
        return;
      }
      
      // 保存数据
      AppData.raw.exam211 = jsonData;
      AppData.index.exam211 = build211Index(jsonData);
      
      // 渲染表格
      render211EditTable();
      
      showMessage('211数据上传成功！', 'success');
      
    } catch (error) {
      console.error('文件解析错误:', error);
      showMessage('文件解析失败，请检查文件格式', 'error');
    }
  };
  
  reader.readAsBinaryString(file);
}

7.6 第六阶段：季度计算功能（2小时）

任务清单
[] 实现季度数据上传
[] 实现季度奖金计算
[] 实现季度报表渲染
[] 实现季度数据导出

代码示例

/**
 * 开始季度计算
 */
function startQuarterlyCalculation() {
  // 1. 检查基础数据
  if (!checkDataReady(['employee', 'task'])) {
    showMessage('请先在月度计算页面上传员工信息和任务分配表', 'warning');
    return;
  }
  
  // 2. 检查季度回款数据
  if (!AppData.raw.quarterPayment) {
    showMessage('请上传季度回款数据', 'warning');
    return;
  }
  
  // 3. 获取选择的季度
  const quarter = document.getElementById('quarter-select').value;
  if (!quarter) {
    showMessage('请选择计算季度', 'warning');
    return;
  }
  
  // 4. 开始计算
  showMessage('正在计算季度奖金，请稍候...', 'info');
  
  setTimeout(() => {
    try {
      // 获取所有业务员
      const employees = Object.keys(AppData.index.employee);
      
      // 批量计算
      const results = employees.map(name => 
        calculateQuarterlyBonus(name, quarter)
      );
      
      // 存储结果
      AppData.results.quarterly = results;
      
      // 渲染表格
      renderQuarterlyReport();
      
      showMessage('季度奖金计算完成！', 'success');
      
    } catch (error) {
      console.error('计算错误:', error);
      showMessage('计算过程中出现错误', 'error');
    }
  }, 100);
}

/**
 * 处理季度回款文件上传
 */
function handleQuarterPaymentUpload(event, type) {
  const file = event.target.files[0];
  if (!file) return;
  
  showMessage('正在读取季度回款数据...', 'info');
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = e.target.result;
      const workbook = XLSX.read(data, { type: 'binary' });
      const sheetName = workbook.SheetNames[0];
      const worksheet = workbook.Sheets[sheetName];
      const jsonData = XLSX.utils.sheet_to_json(worksheet);
      
      // 存储数据
      if (!AppData.raw.quarterPayment) {
        AppData.raw.quarterPayment = {};
      }
      AppData.raw.quarterPayment[type] = jsonData;
      
      // 更新UI状态
      updateUploadStatus(`${type}-payment`, true);
      showMessage(`${type === 'unit' ? '往来单位' : '销售员'}回款数据上传成功！`, 'success');
      
    } catch (error) {
      console.error('文件解析错误:', error);
      showMessage('文件解析失败，请检查文件格式', 'error');
    }
  };
  
  reader.readAsBinaryString(file);
}

/**
 * 渲染季度奖金报表
 */
function renderQuarterlyReport() {
  const data = AppData.results.quarterly;
  if (!data || data.length === 0) {
    showMessage('没有数据可显示', 'warning');
    return;
  }
  
  const tableHtml = `
    <table class="data-table">
      <thead>
        <tr>
          <th>业务员</th>
          <th>季度</th>
          <th>季度任务(元)</th>
          <th>季度回款(元)</th>
          <th>完成率</th>
          <th>基础奖金</th>
          <th>返还金额</th>
          <th>实发奖金</th>
          <th>备注</th>
        </tr>
      </thead>
      <tbody>
        ${data.map(row => renderQuarterlyRow(row)).join('')}
      </tbody>
    </table>
  `;
  
  document.getElementById('quarter-table-wrapper').innerHTML = tableHtml;
}

/**
 * 渲染季度表格行
 */
function renderQuarterlyRow(row) {
  const statusClass = row.数据状态 === '完整' ? 'status-complete' : 'status-missing';
  
  return `
    <tr class="${statusClass}">
      <td>${row.业务员}</td>
      <td>${row.季度}</td>
      <td>${row.季度任务 ? formatMoney(row.季度任务) : '-'}</td>
      <td>${row.季度回款 ? formatMoney(row.季度回款) : '-'}</td>
      <td>${row.完成率 || '-'}</td>
      <td>${row.基础奖金 !== undefined ? formatMoney(row.基础奖金) : '-'}</td>
      <td>${row.返还金额 !== undefined ? formatMoney(row.返还金额) : '-'}</td>
      <td><strong>${row.实发奖金 !== undefined ? formatMoney(row.实发奖金) : '-'}</strong></td>
      <td>${row.备注 || '-'}</td>
    </tr>
  `;
}

/**
 * 导出季度Excel
 */
function exportQuarterlyToExcel() {
  const data = AppData.results.quarterly;
  if (!data || data.length === 0) {
    showMessage('没有数据可导出', 'warning');
    return;
  }
  
  try {
    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.json_to_sheet(data);
    XLSX.utils.book_append_sheet(wb, ws, '季度奖金汇总');
    
    const quarter = document.getElementById('quarter-select').value;
    const filename = `季度奖金_${quarter}_${new Date().toLocaleDateString()}.xlsx`;
    
    XLSX.writeFile(wb, filename);
    showMessage('导出成功！', 'success');
    
  } catch (error) {
    console.error('导出错误:', error);
    showMessage('导出失败', 'error');
  }
}

7.7 第七阶段：UI优化和交互增强（2小时）

任务清单
[] 实现消息提示系统
[] 实现加载动画
[] 实现数据统计面板
[] 实现快捷操作

代码示例

/**
 * 显示消息提示
 */
function showMessage(text, type = 'info', duration = 3000) {
  // 移除已存在的消息
  const existingMessage = document.querySelector('.message');
  if (existingMessage) {
    existingMessage.remove();
  }
  
  // 创建新消息
  const message = document.createElement('div');
  message.className = `message ${type}`;
  message.textContent = text;
  
  // 添加图标
  const icons = {
    success: '✓',
    error: '✗',
    warning: '⚠',
    info: 'ℹ'
  };
  message.innerHTML = `<span class="message-icon">${icons[type]}</span> ${text}`;
  
  document.body.appendChild(message);
  
  // 自动移除
  setTimeout(() => {
    message.style.animation = 'slideUp 0.3s ease';
    setTimeout(() => message.remove(), 300);
  }, duration);
}

/**
 * 显示加载动画
 */
function showLoading(text = '加载中...') {
  const loading = document.createElement('div');
  loading.id = 'loading-overlay';
  loading.innerHTML = `
    <div class="loading-content">
      <div class="spinner"></div>
      <p>${text}</p>
    </div>
  `;
  document.body.appendChild(loading);
}

/**
 * 隐藏加载动画
 */
function hideLoading() {
  const loading = document.getElementById('loading-overlay');
  if (loading) {
    loading.remove();
  }
}

/**
 * 渲染数据统计面板
 */
function renderStatistics() {
  const data = AppData.results.monthly;
  if (!data || data.length === 0) return;
  
  // 计算统计数据
  const stats = {
    总人数: data.length,
    数据完整: data.filter(r => r.数据状态 === '完整').length,
    数据缺失: data.filter(r => r.数据状态 === '数据缺失').length,
    试用期: data.filter(r => r.备注?.includes('试用期')).length,
    总奖金: data.reduce((sum, r) => sum + (r.实发奖金 || 0), 0),
    平均奖金: 0
  };
  
  stats.平均奖金 = stats.总奖金 / (stats.数据完整 || 1);
  
  // 渲染统计卡片
  const statsHtml = `
    <div class="statistics-panel">
      <div class="stat-card">
        <div class="stat-value">${stats.总人数}</div>
        <div class="stat-label">总人数</div>
      </div>
      <div class="stat-card success">
        <div class="stat-value">${stats.数据完整}</div>
        <div class="stat-label">数据完整</div>
      </div>
      <div class="stat-card error">
        <div class="stat-value">${stats.数据缺失}</div>
        <div class="stat-label">数据缺失</div>
      </div>
      <div class="stat-card warning">
        <div class="stat-value">${stats.试用期}</div>
        <div class="stat-label">试用期</div>
      </div>
      <div class="stat-card primary">
        <div class="stat-value">${formatMoney(stats.总奖金)}</div>
        <div class="stat-label">总奖金(元)</div>
      </div>
      <div class="stat-card info">
        <div class="stat-value">${formatMoney(stats.平均奖金)}</div>
        <div class="stat-label">平均奖金(元)</div>
      </div>
    </div>
  `;
  
  // 插入到结果区域顶部
  const resultSection = document.querySelector('.result-section');
  let statsContainer = document.getElementById('statistics-container');
  
  if (!statsContainer) {
    statsContainer = document.createElement('div');
    statsContainer.id = 'statistics-container';
    resultSection.insertBefore(statsContainer, resultSection.firstChild.nextSibling);
  }
  
  statsContainer.innerHTML = statsHtml;
}

/**
 * 表格排序功能
 */
function sortTable(columnIndex, order = 'asc') {
  const table = document.querySelector('.data-table');
  const tbody = table.querySelector('tbody');
  const rows = Array.from(tbody.querySelectorAll('tr'));
  
  rows.sort((a, b) => {
    const aValue = a.cells[columnIndex].textContent;
    const bValue = b.cells[columnIndex].textContent;
    
    // 尝试转换为数字
    const aNum = parseFloat(aValue.replace(/[^0-9.-]/g, ''));
    const bNum = parseFloat(bValue.replace(/[^0-9.-]/g, ''));
    
    if (!isNaN(aNum) && !isNaN(bNum)) {
      return order === 'asc' ? aNum - bNum : bNum - aNum;
    }
    
    return order === 'asc' ? 
      aValue.localeCompare(bValue) : 
      bValue.localeCompare(aValue);
  });
  
  // 重新插入排序后的行
  rows.forEach(row => tbody.appendChild(row));
}

/**
 * 表格筛选功能
 */
function filterTable(keyword) {
  const table = document.querySelector('.data-table');
  const tbody = table.querySelector('tbody');
  const rows = tbody.querySelectorAll('tr');
  
  rows.forEach(row => {
    const text = row.textContent.toLowerCase();
    if (text.includes(keyword.toLowerCase())) {
      row.style.display = '';
    } else {
      row.style.display = 'none';
    }
  });
}

/**
 * 添加表格搜索框
 */
function addTableSearch() {
  const tableActions = document.querySelector('.table-actions');
  
  const searchHtml = `
    <div class="search-box">
      <input type="text" id="table-search" placeholder="搜索业务员、地区..." />
      <button onclick="filterTable(document.getElementById('table-search').value)">
        🔍 搜索
      </button>
      <button onclick="clearTableFilter()">
        ✗ 清除
      </button>
    </div>
  `;
  
  tableActions.insertAdjacentHTML('afterbegin', searchHtml);
}

/**
 * 清除表格筛选
 */
function clearTableFilter() {
  document.getElementById('table-search').value = '';
  const rows = document.querySelectorAll('.data-table tbody tr');
  rows.forEach(row => row.style.display = '');
}

/**
 * 键盘快捷键
 */
document.addEventListener('keydown', function(e) {
  // Ctrl+S 保存211数据
  if (e.ctrlKey && e.key === 's') {
    e.preventDefault();
    const currentPage = document.querySelector('.page:not(.hidden)');
    if (currentPage.id === 'manage-211-page') {
      save211Data();
    }
  }
  
  // Ctrl+E 导出Excel
  if (e.ctrlKey && e.key === 'e') {
    e.preventDefault();
    const currentPage = document.querySelector('.page:not(.hidden)');
    if (currentPage.id === 'monthly-page') {
      exportToExcel();
    } else if (currentPage.id === 'quarterly-page') {
      exportQuarterlyToExcel();
    }
  }
});


---

测试方案

8.1 单元测试

8.1.1 计算函数测试

/**
 * 测试月度奖金计算
 */
function testMonthlyCalculation() {
  console.log('开始测试月度奖金计算...');
  
  // 准备测试数据
  AppData.index.employee = {
    '测试员工': {
      标准奖金: 7000,
      所属地区: '杭州',
      业务类型: '五星',
      是否试用期: false
    }
  };
  
  AppData.index.task = {
    '测试员工': {
      '1': 400000  // 40万
    }
  };
  
  AppData.index.sales = {
    '测试员工': {
      '1': 200000  // 20万，完成率50%
    }
  };
  
  AppData.index.exam211 = {
    '测试员工': {
      '1': { 任务: 10, 完成: 5 }
    }
  };
  
  // 执行计算
  const result = calculateMonthlyBonus('测试员工', '1');
  
  // 验证结果
  console.assert(result.完成率 === '50.00%', '完成率计算错误');
  console.assert(result.基础奖金 === 2450, '基础奖金计算错误');
  console.assert(result.回款负激励 === 700, '回款负激励计算错误');
  console.assert(result.负激励211 === 400, '211负激励计算错误');
  console.assert(result.实发奖金 === 1350, '实发奖金计算错误');
  
  console.log('月度奖金计算测试通过 ✓');
  console.log('测试结果:', result);
}

/**
 * 测试季度奖金计算
 */
function testQuarterlyCalculation() {
  console.log('开始测试季度奖金计算...');
  
  // 准备测试数据
  AppData.index.employee = {
    '测试员工': {
      标准奖金: 7000,
      所属地区: '杭州',
      是否试用期: false
    }
  };
  
  AppData.index.task = {
    '测试员工': {
      '1': 400000,
      '2': 400000,
      '3': 400000
    }
  };
  
  AppData.index.sales = {
    '测试员工': {
      '1': 320000,  // 80%
      '2': 340000,  // 85%
      '3': 360000   // 90%
    }
  };
  
  // 执行计算
  const result = calculateQuarterlyBonus('测试员工', 'Q1');
  
  // 验证结果
  console.assert(result.季度任务 === 1200000, '季度任务计算错误');
  console.assert(result.季度回款 === 1020000, '季度回款计算错误');
  console.assert(result.完成率 === '85.00%', '季度完成率计算错误');
  console.assert(result.返还金额 > 0, '返还金额计算错误');
  
  console.log('季度奖金计算测试通过 ✓');
  console.log('测试结果:', result);
}

/**
 * 测试试用期员工
 */
function testTrialEmployee() {
  console.log('开始测试试用期员工...');
  
  AppData.index.employee = {
    '试用员工': {
      标准奖金: 5000,
      所属地区: '杭州',
      是否试用期: true
    }
  };
  
  AppData.index.task = {
    '试用员工': { '1': 300000 }
  };
  
  AppData.index.sales = {
    '试用员工': { '1': 100000 }
  };
  
  const result = calculateMonthlyBonus('试用员工', '1');
  
  console.assert(result.基础奖金 === 0, '试用期基础奖金应为0');
  console.assert(result.回款负激励 === 0, '试用期负激励应为0');
  console.assert(result.实发奖金 === 0, '试用期实发奖金应为0');
  
  console.log('试用期员工测试通过 ✓');
}

8.2 集成测试

8.2.1 完整流程测试

/**
 * 测试完整计算流程
 */
async function testCompleteWorkflow() {
  console.log('开始完整流程测试...');
  
  try {
    // 1. 模拟上传员工信息
    console.log('步骤1: 上传员工信息');
    AppData.raw.employee = [
      { 员工姓名: '张三', 标准奖金: 7000, 所属地区: '杭州', 业务类型: '五星', 备注: '' },
      { 员工姓名: '李四', 标准奖金: 6000, 所属地区: '宁波', 业务类型: '四星', 备注: '' }
    ];
    AppData.index.employee = buildEmployeeIndex(AppData.raw.employee);
    console.log('✓ 员工信息上传成功');
    
    // 2. 模拟上传任务分配
    console.log('步骤2: 上传任务分配');
    AppData.raw.task = [
      { 负责人: '张三', 区域: '汇德隆', '1月': 40, '2月': 35, '3月': 45 },
      { 负责人: '李四', 区域: '永乐', '1月': 30, '2月': 28, '3月': 32 }
    ];
    AppData.index.task = buildTaskIndex(AppData.raw.task);
    console.log('✓ 任务分配

上传成功');
    // 3. 模拟上传回款数据
    console.log('步骤3: 上传回款数据');
    AppData.raw.sales = [
      { 销售员: '张三', '1月': 320000, '2月': 280000, '3月': 360000 },
      { 销售员: '李四', '1月': 240000, '2月': 224000, '3月': 256000 }
    ];
    AppData.index.sales = buildSalesIndex(AppData.raw.sales);
    console.log('✓ 回款数据上传成功');
    // 4. 模拟上传211数据
    console.log('步骤4: 上传211数据');
    AppData.raw.exam211 = [
      { 月份: '1', 业务人员: '张三', 任务: 10, 完成: 8, 备注: '' },
      { 月份: '1', 业务人员: '李四', 任务: 10, 完成: 7, 备注: '' }
    ];
    AppData.index.exam211 = build211Index(AppData.raw.exam211);
    console.log('✓ 211数据上传成功');
    // 5. 执行月度计算
    console.log('步骤5: 执行月度计算');
    const employees = Object.keys(AppData.index.employee);
    const monthlyResults = employees.map(name => calculateMonthlyBonus(name, '1'));
    AppData.results.monthly = monthlyResults;
    console.log('✓ 月度计算完成');
    console.table(monthlyResults);
    // 6. 执行季度计算
    console.log('步骤6: 执行季度计算');
    const quarterlyResults = employees.map(name => calculateQuarterlyBonus(name, 'Q1'));
    AppData.results.quarterly = quarterlyResults;
    console.log('✓ 季度计算完成');
    console.table(quarterlyResults);
    console.log('✅ 完整流程测试通过！');
  } catch (error) {
    console.error('❌ 测试失败:', error);
  }
}

### 8.3 边界测试

```javascript
/**
 * 测试边界情况
 */
function testBoundaryConditions() {
  console.log('开始边界条件测试...');
  
  // 测试1: 完成率为0
  console.log('测试1: 完成率为0');
  AppData.index.employee = { '员工A': { 标准奖金: 7000, 所属地区: '杭州', 是否试用期: false } };
  AppData.index.task = { '员工A': { '1': 400000 } };
  AppData.index.sales = { '员工A': { '1': 0 } };
  AppData.index.exam211 = { '员工A': { '1': { 任务: 10, 完成: 0 } } };
  
  let result = calculateMonthlyBonus('员工A', '1');
  console.assert(result.完成率 === '0.00%', '完成率0测试失败');
  console.assert(result.基础奖金 === 0, '基础奖金应为0');
  console.log('✓ 完成率0测试通过');
  
  // 测试2: 完成率超过100%
  console.log('测试2: 完成率超过100%');
  AppData.index.sales = { '员工A': { '1': 500000 } };
  result = calculateMonthlyBonus('员工A', '1');
  console.assert(result.完成率 === '125.00%', '完成率超100%测试失败');
  console.assert(result.基础奖金 > 7000 * 0.7, '超额完成奖金计算错误');
  console.log('✓ 完成率超100%测试通过');
  
  // 测试3: 完成率刚好50%（临界值）
  console.log('测试3: 完成率50%临界值');
  AppData.index.sales = { '员工A': { '1': 200000 } };
  result = calculateMonthlyBonus('员工A', '1');
  console.assert(result.完成率 === '50.00%', '完成率50%测试失败');
  console.assert(result.回款负激励 === 1400, '50%负激励应扣20%');
  console.log('✓ 完成率50%测试通过');
  
  // 测试4: 完成率刚好80%（临界值）
  console.log('测试4: 完成率80%临界值');
  AppData.index.sales = { '员工A': { '1': 320000 } };
  result = calculateMonthlyBonus('员工A', '1');
  console.assert(result.完成率 === '80.00%', '完成率80%测试失败');
  console.assert(result.回款负激励 === 0, '80%不应扣负激励');
  console.log('✓ 完成率80%测试通过');
  
  // 测试5: 缺失数据
  console.log('测试5: 缺失数据处理');
  delete AppData.index.task['员工A'];
  result = calculateMonthlyBonus('员工A', '1');
  console.assert(result.数据状态 === '数据缺失', '缺失数据状态错误');
  console.log('✓ 缺失数据测试通过');
  
  // 测试6: 非杭州地区
  console.log('测试6: 非杭州地区无负激励');
  AppData.index.employee = { '员工B': { 标准奖金: 6000, 所属地区: '宁波', 是否试用期: false } };
  AppData.index.task = { '员工B': { '1': 300000 } };
  AppData.index.sales = { '员工B': { '1': 100000 } };
  AppData.index.exam211 = { '员工B': { '1': { 任务: 10, 完成: 5 } } };
  
  result = calculateMonthlyBonus('员工B', '1');
  console.assert(result.回款负激励 === 0, '非杭州地区不应有回款负激励');
  console.log('✓ 非杭州地区测试通过');
  
  console.log('✅ 所有边界条件测试通过！');
}

/**
 * 测试数据验证
 */
function testDataValidation() {
  console.log('开始数据验证测试...');
  
  // 测试1: 空数据
  let result = validateData([], 'employee');
  console.assert(!result.valid, '空数据应验证失败');
  console.log('✓ 空数据验证通过');
  
  // 测试2: 缺少必需列
  result = validateData([{ 员工姓名: '张三' }], 'employee');
  console.assert(!result.valid, '缺少必需列应验证失败');
  console.log('✓ 缺少必需列验证通过');
  
  // 测试3: 数据类型错误
  result = validateData([
    { 员工姓名: '张三', 标准奖金: '七千', 所属地区: '杭州', 业务类型: '五星' }
  ], 'employee');
  console.assert(!result.valid, '数据类型错误应验证失败');
  console.log('✓ 数据类型验证通过');
  
  // 测试4: 重复数据
  result = validateData([
    { 员工姓名: '张三', 标准奖金: 7000, 所属地区: '杭州', 业务类型: '五星' },
    { 员工姓名: '张三', 标准奖金: 6000, 所属地区: '宁波', 业务类型: '四星' }
  ], 'employee');
  console.assert(!result.valid, '重复数据应验证失败');
  console.log('✓ 重复数据验证通过');
  
  // 测试5: 正确数据
  result = validateData([
    { 员工姓名: '张三', 标准奖金: 7000, 所属地区: '杭州', 业务类型: '五星' },
    { 员工姓名: '李四', 标准奖金: 6000, 所属地区: '宁波', 业务类型: '四星' }
  ], 'employee');
  console.assert(result.valid, '正确数据应验证通过');
  console.log('✓ 正确数据验证通过');
  
  console.log('✅ 所有数据验证测试通过！');
}

8.4 性能测试

/**
 * 测试大数据量性能
 */
function testPerformance() {
  console.log('开始性能测试...');
  
  // 生成大量测试数据
  const employeeCount = 100;
  const employees = [];
  const tasks = [];
  const sales = [];
  const exam211 = [];
  
  console.log(`生成${employeeCount}个员工的测试数据...`);
  
  for (let i = 1; i <= employeeCount; i++) {
    employees.push({
      员工姓名: `员工${i}`,
      标准奖金: 5000 + Math.random() * 3000,
      所属地区: i % 2 === 0 ? '杭州' : '宁波',
      业务类型: '五星',
      备注: i % 10 === 0 ? '试用期' : ''
    });
    
    const taskRow = { 负责人: `员工${i}`, 区域: `区域${i}` };
    for (let m = 1; m <= 12; m++) {
      taskRow[`${m}月`] = 30 + Math.random() * 20;
    }
    tasks.push(taskRow);
    
    const salesRow = { 销售员: `员工${i}` };
    for (let m = 1; m <= 12; m++) {
      salesRow[`${m}月`] = (30 + Math.random() * 20) * 10000 * (0.7 + Math.random() * 0.5);
    }
    sales.push(salesRow);
    
    for (let m = 1; m <= 12; m++) {
      exam211.push({
        月份: String(m),
        业务人员: `员工${i}`,
        任务: 10,
        完成: Math.floor(Math.random() * 11),
        备注: ''
      });
    }
  }
  
  // 测试数据索引构建性能
  console.log('测试索引构建性能...');
  let startTime = performance.now();
  AppData.index.employee = buildEmployeeIndex(employees);
  AppData.index.task = buildTaskIndex(tasks);
  AppData.index.sales = buildSalesIndex(sales);
  AppData.index.exam211 = build211Index(exam211);
  let endTime = performance.now();
  console.log(`✓ 索引构建耗时: ${(endTime - startTime).toFixed(2)}ms`);
  
  // 测试月度计算性能
  console.log('测试月度计算性能...');
  startTime = performance.now();
  const monthlyResults = [];
  for (let i = 1; i <= employeeCount; i++) {
    monthlyResults.push(calculateMonthlyBonus(`员工${i}`, '1'));
  }
  endTime = performance.now();
  console.log(`✓ 月度计算耗时: ${(endTime - startTime).toFixed(2)}ms`);
  console.log(`  平均每人: ${((endTime - startTime) / employeeCount).toFixed(2)}ms`);
  
  // 测试季度计算性能
  console.log('测试季度计算性能...');
  startTime = performance.now();
  const quarterlyResults = [];
  for (let i = 1; i <= employeeCount; i++) {
    quarterlyResults.push(calculateQuarterlyBonus(`员工${i}`, 'Q1'));
  }
  endTime = performance.now();
  console.log(`✓ 季度计算耗时: ${(endTime - startTime).toFixed(2)}ms`);
  console.log(`  平均每人: ${((endTime - startTime) / employeeCount).toFixed(2)}ms`);
  
  // 测试Excel导出性能
  console.log('测试Excel导出性能...');
  AppData.results.monthly = monthlyResults;
  startTime = performance.now();
  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.json_to_sheet(monthlyResults);
  XLSX.utils.book_append_sheet(wb, ws, '月度奖金');
  endTime = performance.now();
  console.log(`✓ Excel生成耗时: ${(endTime - startTime).toFixed(2)}ms`);
  
  console.log('✅ 性能测试完成！');
}


---

部署说明

9.1 本地部署

9.1.1 单文件部署

# 1. 将所有代码整合到一个HTML文件
# 2. 保存为 salary-calculator.html
# 3. 双击打开即可使用

# 文件结构：
salary-calculator.html  # 主文件（包含所有HTML/CSS/JS）

9.1.2 分离式部署

# 文件结构：
project/
├── index.html           # 主HTML文件
├── css/
│   └── style.css       # 样式文件
├── js/
│   ├── app.js          # 主应用逻辑
│   ├── calculator.js   # 计算引擎
│   ├── data-manager.js # 数据管理
│   └── ui-controller.js # UI控制
├── lib/
│   └── xlsx.full.min.js # Excel库（可选本地）
└── README.md           # 使用说明

9.2 Web服务器部署

9.2.1 Nginx配置

server {
    listen 80;
    server_name salary.example.com;
    
    root /var/www/salary-calculator;
    index index.html;
    
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # 启用Gzip压缩
    gzip on;
    gzip_types text/css application/javascript application/json;
    
    # 缓存静态资源
    location ~* \.(css|js|jpg|png|gif|ico)$ {
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}

9.2.2 Apache配置

<VirtualHost *:80>
    ServerName salary.example.com
    DocumentRoot /var/www/salary-calculator
    
    <Directory /var/www/salary-calculator>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>
    
    # 启用压缩
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/css application/javascript
    </IfModule>
</VirtualHost>

9.3 内网部署

# 使用Python简易服务器（适合测试）
cd /path/to/project
python -m http.server 8080

# 或使用Node.js
npx http-server -p 8080

# 访问地址：
# http://localhost:8080
# http://192.168.1.100:8080 (局域网访问)

9.4 打包为桌面应用

9.4.1 使用Electron打包

# 1. 安装Electron
npm install -g electron

# 2. 创建package.json
{
  "name": "salary-calculator",
  "version": "1.0.0",
  "main": "main.js",
  "scripts": {
    "start": "electron ."
  }
}

# 3. 创建main.js
const { app, BrowserWindow } = require('electron');

function createWindow() {
  const win = new BrowserWindow({
    width: 1400,
    height: 900,
    webPreferences: {
      nodeIntegration: true
    }
  });
  
  win.loadFile('index.html');
}

app.whenReady().then(createWindow);

# 4. 打包
npm install electron-builder --save-dev
npm run build

9.5 版本管理

// 在代码中添加版本信息
const APP_VERSION = '1.0.0';
const APP_BUILD_DATE = '2025-10-08';

// 显示版本信息
function showVersion() {
  console.log(`业务员奖金计算系统 v${APP_VERSION}`);
  console.log(`构建日期: ${APP_BUILD_DATE}`);
}

// 检查更新（可选）
function checkUpdate() {
  // 实现版本检查逻辑
}


---

附录

10.1 常见问题解答

Q1: Excel文件无法上传？
A: 检查以下几点：
- 文件格式是否为.xlsx或.xls
- 文件是否损坏
- 文件大小是否超过浏览器限制（建议<10MB）
- 是否包含必需的列名
  
Q2: 计算结果不正确？
A: 请检查：
- 数据单位是否正确（任务是否为万元）
- 月份格式是否统一
- 员工姓名是否完全匹配（注意空格）
- 是否正确标注试用期员工
  
Q3: 导出的Excel乱码？
A: 这是编码问题，解决方法：
- 使用最新版本的Excel打开
- 或用记事本打开，另存为UTF-8编码
  
Q4: 如何批量修改211数据？
A: 两种方法：
1. 在211管理页面在线编辑
2. 导出Excel，修改后重新上传
  
10.2 Excel模板说明

员工基础信息表模板

员工姓名
标准奖金
所属地区
业务类型
备注
张三
7000
杭州
五星

李四
6000
宁波
四星
试用期

任务分配表模板

负责人
区域
1月
2月
3月
...
Q1
Q2
Q3
Q4
张三
汇德隆
40
35
45
...
120
130
140
150

注意： 任务单位为万元

销售员回款汇总表模板

销售员
销售组织
销售部门
总收款
总退款
回款
张三
杭州中冠电器
杭州大区
433809
8090
425719

注意： 回款单位为元

211厨电表模板

月份
具体地区
业务人员
任务
完成
备注
1
汇德隆
张三
10
8

1
永乐
李四
10
7


10.3 计算公式速查表

月度奖金计算

完成率 = 回款 / 任务

基础奖金 = 标准奖金 × 70% × 完成率

回款负激励（仅杭州）:
  - 完成率 < 50%: 扣标准奖金 × 20%
  - 50% ≤ 完成率 < 80%: 扣标准奖金 × 10%
  - 完成率 ≥ 80%: 不扣

211负激励 = 800 - (完成分值 / 任务分值) × 800

实发奖金 = 基础奖金 - 回款负激励 - 211负激励

季度奖金计算

季度完成率 = 季度回款 / 季度任务

基础奖金 = 标准奖金 × 30% × 3 × 季度完成率

杭州红线规则:
  - 季度完成率 < 50%: 季度奖金归零

返还金额（仅杭州，季度完成率≥80%）:
  返还该季度所有月度回款负激励

实发奖金 = 基础奖金 + 返还金额

10.4 快捷键列表

快捷键
功能
Ctrl + S
保存211数据
Ctrl + E
导出Excel
Ctrl + F
搜索表格
Esc
关闭弹窗

10.5 浏览器兼容性

浏览器
最低版本
推荐版本
Chrome
80+
最新版
Firefox
75+
最新版
Edge
80+
最新版
Safari
13+
最新版

不支持： IE11及以下版本

10.6 更新日志

v1.0.0 (2025-10-08)
- ✨ 初始版本发布
- ✅ 实现月度奖金计算
- ✅ 实现季度奖金计算
- ✅ 实现211数据管理
- ✅ 支持Excel导入导出
- ✅ 支持试用期员工识别
  
未来计划
[] 添加数据可视化图表
[] 支持历史数据对比
[] 添加自定义计算规则
[] 支持多用户权限管理
[] 移动端适配优化


---

总结

这份开发文档涵盖了业务员奖金计算系统的完整开发流程，包括：

1. 系统设计：清晰的架构和模块划分
2. 数据结构：详细的输入输出格式定义
3. 核心算法：完整的计算逻辑实现
4. 界面设计：规范的UI组件和样式
5. 开发步骤：分阶段的实施计划
6. 测试方案：全面的测试用例
7. 部署指南：多种部署方式选择
  
按照这份文档，开发者可以系统地完成整个项目的开发工作。建议按照7个阶段逐步实施，每完成一个阶段进行充分测试后再进入下一阶段。

预计总开发时间： 15-20小时
难度等级： 中等
技术要求： HTML/CSS/JavaScript基础，Excel处理经验

